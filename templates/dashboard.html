{% extends 'dash-nav.html' %}
<html lang="en">
    {% block header %}
    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/offcanvas/">
    <link href="{{url_for('static', filename='img/favicon.io')}}" rel="icon" type="image/x-icon" />


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
  
      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <style>
      /* Set the size of the div element that contains the map */
      #map {
        height: 400px;
        width: 400px;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
    <script>
      // Initialize and add the map
      var map;
  
      function haversine_distance(mk1, mk2) {
        var R = 3958.8; // Radius of the Earth in miles
        var rlat1 = mk1.position.lat() * (Math.PI / 180); // Convert degrees to radians
        var rlat2 = mk2.position.lat() * (Math.PI / 180); // Convert degrees to radians
        var difflat = rlat2 - rlat1; // Radian difference (latitudes)
        var difflon = (mk2.position.lng() - mk1.position.lng()) * (Math.PI / 180); // Radian difference (longitudes)
  
        var d = 2 * R * Math.asin(Math.sqrt(Math.sin(difflat / 2) * Math.sin(difflat / 2) + Math.cos(rlat1) * Math.cos(rlat2) * Math.sin(difflon / 2) * Math.sin(difflon / 2)));
        return d;
      }
  
      function initMap() {
        // The map, centered on Central Park
        const center = {
          lat: 37.559180953,
          lng: -121.9842194
        };
        const options = {
          zoom: 15,
          scaleControl: true,
          center: center
        };
        map = new google.maps.Map(
          document.getElementById('map'), options);
        // Locations of landmarks
        const dakota = {
          lat: 37.559340,
          lng: -121.994570
        };
        const frick = {
          lat: 37.559021,
          lng: -121.973869
        };
        // The markers for The Dakota and The Frick Collection
        var mk1 = new google.maps.Marker({
          position: dakota,
          map: map
        });
        var mk2 = new google.maps.Marker({
          position: frick,
          map: map
        });
  
        // Calculate and display the distance between markers
        var distance = haversine_distance(mk1, mk2);
  
        let directionsService = new google.maps.DirectionsService();
        let directionsRenderer = new google.maps.DirectionsRenderer();
        directionsRenderer.setMap(map); // Existing map object displays directions
        // Create route from existing points used for markers
        const route = {
          origin: dakota,
          destination: frick,
          travelMode: 'DRIVING'
        }
  
        directionsService.route(route,
          function(response, status) { // anonymous function to capture directions
            if (status !== 'OK') {
              window.alert('Directions request failed due to ' + status);
              return;
            } else {
              directionsRenderer.setDirections(response); // Add route to the map
              var directionsData = response.routes[0].legs[0]; // Get data about the mapped route
              if (!directionsData) {
                window.alert('Directions request failed');
                return;
              } else {
                document.getElementById('msg').innerHTML += " Driving distance is " + directionsData.distance.text + " (" + directionsData.duration.text + ").";
              }
            }
          });
      }
    </script>
    <!--Load the API from the specified URL  remember to replace YOUR_API_KEY-->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcffvVneXYKDx5oDGck0Z4QETG2Oq2UTo&callback=initMap">
    </script>
  <!-- Custom styles for this template -->
  <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
    {% endblock %}

  <body class="title">
    {% block content %}

    <main role="main" class="container">

      <div class="my-3 p-3 bg-white rounded shadow-sm">
        <h6 class="border-bottom border-gray pb-2 mb-0">Current Jobs</h6>
        {% if o_e  %}
        {% for doc in offered %}

        {% set service = doc.to_dict()%}
        {% if not service['finished'] %}
        <form action="" method="POST">
          {{mark.hidden_tag()}}

          {% if service['finished'] %}
            {% set color = '#5cb85c' %}
          {% else %}
            {% if service['accepted'] %}
            {% set color = '#ffff32' %}
            {% else %}
            {% set color = '#d9534f' %}
            {% endif %}
          {% endif %}
          <div class="media text-muted pt-3">
            <svg class="bd-placeholder-img mr-2 rounded" width="72" height="72" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32">
              <title>Placeholder</title>
              <rect width="100%" height="100%" fill="{{color}}"/><text x="50%" y="50%" fill="{{color}}" dy=".3em">32x32</text>
            </svg>
            <p class="media-body pb-3 mb-0 large lh-125 border-bottom border-gray">
              <strong class="date d-block text-gray-dark"> {% if service['creator'] != "" %} Assigned by @ {{service['creator']}} {% else %} Pending request approved... {% endif %}</strong>
    
              <span>{{service['title']}}</span>
              <span class="date"> | Reward: ${{service['reward']}}</span>
    
              <span class="d-block date">{{service['description']}}</span>
    
              <button type="button" class="date btn btn-sm btn-outline-secondary" data-toggle="modal" data-target="#map{{doc.id}}Modal" style="float: right;">View Location</button>
              {% if not service['wfinished'] %}
              <!-- <button type="button" class="pad date btn btn-sm btn-outline-primary" style="float: right;">Mark as Done</button> -->
              <input type="hidden" id="markasdone" name="markasdone" value="True">
              <input type="hidden" id="mdoc_id" name="mdoc_id" value="{{doc.id}}">
              {{mark.submit(class_="pad date btn btn-sm btn-outline-primary")}}
              {% endif %}
              <div class="modal fade" id="map{{doc.id}}Modal" tabindex="-1" role="dialog" aria-labelledby="map{{doc.id}}ModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="map{{doc.id}}ModalLabel">Complete Job</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <div class="card mb-4 shadow-sm">
                        
                        <!--The div elements for the map and message -->
                        <div id="map"></div>
                        <div id="msg"></div>
    
                        <div class="card-body">
                          <p class="card-text">{{service['title']}}</p>
                          <p class="card-text">{{service['description']}}</p>
                          <div class="d-flex justify-content-between align-items-center">
    
                            <small class="text-muted">Reward: ${{service['reward']}}</small>
                          </div>
                          <div class="d-flex justify-content-between align-items-center">
    
                            <small class="text-muted">Date Assigned: {{service['date']}}</small>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <input type="hidden" id="mdoc_id" name="mdoc_id" value="{{doc.id}}">
                      <input type="hidden" id="markasdone" name="markasdone" value="True">
                      {{mark.submit(class_="btn btn-primary")}}
                    </div>
                  </div>
                </div>
              </div>
            </p>
          </div>
        </form>
        {% endif %}
        {% endfor %}
        {% else %}
          <strong>Sorry, you have not offered any services yet...</strong>
                    <!-- make look better -->
        
        
        {% endif %}
        <small class="d-block text-right mt-3">
          <a href="#">All updates</a>
        </small>
      </div>
  
      <div class="my-3 p-3 bg-white rounded shadow-sm">
        <h6 class="border-bottom border-gray pb-2 mb-0">Current Job Requests</h6>
        {% if r_e  %}
        {% for doc in requested %}
        {% set service = doc.to_dict()%}
        <form action="" method="POST">
          {{confirm.hidden_tag()}}
          <div class="media text-muted pt-3">
            <svg class="bd-placeholder-img mr-2 rounded" width="72" height="72" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32">
              <title>Placeholder</title>
              
              {% if service['finished'] %}
                {% set color = '#5cb85c' %}
              {% else %}
                {% if service['accepted'] %}
                {% set color = '#ffff32' %}
                {% else %}
                {% set color = '#d9534f' %}
                {% endif %}
              {% endif %}

              <rect width="100%" height="100%" fill="{{color}}" /><text x="50%" y="50%" fill="{{color}}" dy=".3em">32x32</text>
            </svg>
            <p class="media-body pb-3 mb-0 large lh-125 border-bottom border-gray">
              <strong class="d-block text-gray-dark">{% if service['worker'] != "" %} Accepted by @ {{service['worker']}} {% else %} Pending request approved... {% endif %}</strong>
              <span>{{service['title']}}</span>
              <span class="date">Reward: ${{service['reward']}}</span>
    
              <span class="d-block date">{{service['description']}}</span>

              <button type="button" class="date btn btn-sm btn-outline-secondary" data-toggle="modal" data-target="#job{{doc.id}}Modal" style="float: right;">View Location</button>
              {% if service['wfinished'] and not service['finished'] %}
              <input type="hidden" id="confirmdone" name="confirmdone" value="True">
              <input type="hidden" id="doc_id" name="doc_id" value="{{doc.id}}">
              {{confirm.submit(class_="pad date btn btn-sm btn-outline-primary")}}
              {% endif %}


              <div class="modal fade" id="job{{doc.id}}Modal" tabindex="-1" role="dialog" aria-labelledby="job{{doc.id}}ModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="job{{doc.id}}ModalLabel">Confirm Job</h5>
                    </div>
                    <div class="modal-body">
                      <div class="card mb-4 shadow-sm">
    
                        <div class="card-body">
                          <p class="card-text">{{service['title']}}</p>
                          <p class="card-text">{{service['description']}}</p>
                          <div class="d-flex justify-content-between align-items-center">
    
                            <small class="text-muted">Reward: ${{service['reward']}}</small>
                          </div>
                          <div class="d-flex justify-content-between align-items-center">
    
                            <small class="text-muted">Date Assigned: {{service['date']}}</small>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      {% if service['wfinished'] and not service['finished']%}
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <input type="hidden" id="doc_id" name="doc_id" value="{{doc.id}}">
                      <input type="hidden" id="confirmdone" name="confirmdone" value="True">
                      {{confirm.submit(class_="btn btn-primary")}}
                    {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </p>
          </div>
        </form>

        {% endfor %}
        {% else %}
          <strong>Sorry, you have not offered any services yet...</strong>
          <!-- make look better -->
        {% endif %}
        <small class="d-block text-right mt-3">
          <a href="#">All updates</a>
        </small>
      </div>
  
      <div class="my-3 p-3 bg-white rounded shadow-sm">
        <h6 class="border-bottom border-gray pb-2 mb-0">History</h6>
        {% if  c_e  %}
        {% for doc in completed %}
        {% set service = doc.to_dict()%}
        <form action="" method="POST">
          {{confirm.hidden_tag()}}
          <div class="media text-muted pt-3">

            <svg class="bd-placeholder-img mr-2 rounded" width="72" height="72" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32">
              <title>Placeholder</title>
              

              <rect width="100%" height="100%" fill="#007bff" /><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text>
            </svg>
            <p class="media-body pb-3 mb-0 large lh-125 border-bottom border-gray">
              <strong class="d-block text-gray-dark"> Accepted by @{{service['worker']}} | Asked by @{{service['creator']}}</strong>
              <span>{{service['title']}}</span>
              <span class="date">Reward: ${{service['reward']}}</span>
    
              <span class="d-block date">{{service['description']}}</span>

              <button type="button" class="date btn btn-sm btn-outline-secondary" data-toggle="modal" data-target="#job{{doc.id}}Modal" style="float: right;">View Location</button>
              {% if service['wfinished'] and not service['finished'] %}
              <input type="hidden" id="confirmdone" name="confirmdone" value="True">
              <input type="hidden" id="doc_id" name="doc_id" value="{{doc.id}}">
              {{confirm.submit(class_="pad date btn btn-sm btn-outline-primary")}}
              {% endif %}


              <div class="modal fade" id="job{{doc.id}}Modal" tabindex="-1" role="dialog" aria-labelledby="job{{doc.id}}ModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="job{{doc.id}}ModalLabel">Confirm Job</h5>
                    </div>
                    <div class="modal-body">
                      <div class="card mb-4 shadow-sm">
    
                        <div class="card-body">
                          <p class="card-text">{{service['title']}}</p>
                          <p class="card-text">{{service['description']}}</p>
                          <div class="d-flex justify-content-between align-items-center">
    
                            <small class="text-muted">Reward: ${{service['reward']}}</small>
                          </div>
                          <div class="d-flex justify-content-between align-items-center">
    
                            <small class="text-muted">Date Assigned: {{service['date']}}</small>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      {% if service['wfinished'] and not service['finished']%}
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <input type="hidden" id="doc_id" name="doc_id" value="{{doc.id}}">
                      <input type="hidden" id="confirmdone" name="confirmdone" value="True">
                      {{confirm.submit(class_="btn btn-primary")}}
                    {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </p>
          </div>
        </form>

        {% endfor %}
        {% else %}
          <strong>Sorry, you have not completed any services yet...</strong>
        {% endif %}
        
        <small class="d-block text-right mt-3">
          <a href="#">All suggestions</a>
        </small>
      </div>
    </main>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="../assets/dist/js/bootstrap.bundle.js"></script>
          <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script></body>
    {% endblock %}
 
</html>
